<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Storage Service v1.1</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="./static/css/custom.css" rel="stylesheet">
    <script>window.BASE_PATH = "{{ config['APPLICATION_ROOT'] | default('') }}";</script>
</head>
<body class="modern-dark">
    <div class="container-fluid h-100 p-0">
        <div class="row h-100 g-0">
            <!-- Sidebar -->
            <div class="col-xl-2 col-lg-3 col-md-4 sidebar">
                <div class="sidebar-content">
                    <!-- Logo/Brand -->
                    <div class="brand-section">
                        <div class="brand-icon" onclick="app.loadFolder('')" style="cursor: pointer;">
                            <i class="fas fa-images"></i>
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="nav-section">
                        <div class="nav-item active" onclick="app.loadFolder('')">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="nav-item" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="nav-item" data-bs-toggle="modal" data-bs-target="#newFolderModal">
                            <i class="fas fa-folder-plus"></i>
                        </div>
                        <div class="nav-item" id="refreshTree" onclick="app.loadFolderTree()">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                    </div>
                    
                    <!-- Filter Section -->
                    <div class="filter-section">
                        <h6 class="filter-title">Filter</h6>
                        
                        <div class="filter-group">
                            <label class="filter-label">Folder Tree</label>
                            <div class="folder-tree-actions">
                                <button class="btn-tree-action" id="addSubfolderBtn" title="Add Subfolder" data-bs-toggle="modal" data-bs-target="#newFolderModal">
                                    <i class="fas fa-folder-plus"></i>
                                </button>
                                <button class="btn-tree-action" id="refreshTreeBtn" title="Refresh" onclick="app.loadFolderTree()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div id="folderTree" class="folder-tree">
                                <ul id="rootFolder" class="folder-list">
                                    <!-- Folder tree will be populated here by JavaScript -->
                                </ul>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">View Mode</label>
                            <div class="view-toggle">
                                <button class="btn-view active" data-view="grid">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="btn-view" data-view="list">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Image Size</label>
                            <div class="size-options">
                                <input type="radio" id="size-small" name="imageSize" value="small">
                                <label for="size-small">Small</label>
                                
                                <input type="radio" id="size-medium" name="imageSize" value="medium" checked>
                                <label for="size-medium">Medium</label>
                                
                                <input type="radio" id="size-large" name="imageSize" value="large">
                                <label for="size-large">Large</label>
                            </div>
                        </div>
                        
                        <!-- Public Base URL Setting -->
                        <div class="filter-group">
                            <label class="filter-label" id="publicBaseUrlLabel">Public Base URL</label>
                            <input type="text" class="form-control form-control-sm" id="publicBaseUrlInput" placeholder="e.g. https://yourdomain.com/images">
                            <div class="form-text" id="publicBaseUrlHint">This URL is used when copying image links.</div>
                            <div class="d-flex justify-content-between mt-2">
                                <button class="btn btn-sm btn-outline-secondary" id="savePublicBaseUrlBtn">Save</button>
                                <button class="btn btn-sm btn-outline-secondary" id="resetPublicBaseUrlBtn">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Main content -->
            <main class="col-xl-10 col-lg-9 col-md-8 main-content">
                <!-- Header -->
                <div class="content-header">
                    <div class="header-left">
                        <button class="btn-back" onclick="history.back()">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 class="page-title" id="pageTitle">Bild-Speicher-Tool</h1>
                        <div class="language-switcher ms-3">
                            <button class="btn btn-sm btn-outline-secondary" onclick="app.switchLanguage('de')" id="btnDe">DE</button>
                            <button class="btn btn-sm btn-outline-secondary ms-1" onclick="app.switchLanguage('en')" id="btnEn">EN</button>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="btn-generate" data-bs-toggle="modal" data-bs-target="#uploadModal" id="uploadImageBtn">
                            Bild hochladen <i class="fas fa-sparkles"></i>
                        </button>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Breadcrumb -->
                    <div class="breadcrumb-section">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb-modern" id="breadcrumb">
                                <li class="breadcrumb-item"><a href="#" onclick="app.loadFolder('')">Home</a></li>
                            </ol>
                        </nav>
                    </div>

                    <!-- Image Grid -->
                    <div class="image-gallery" id="fileGrid">
                        <!-- Images will be populated here -->
                    </div>

                    <!-- Loading indicator -->
                    <div id="loadingIndicator" class="loading-state d-none">
                        <div class="spinner-modern">
                            <div class="spinner-circle"></div>
                        </div>
                        <p class="loading-text">Loading images...</p>
                    </div>

                    <!-- Empty state -->
                    <div id="emptyState" class="empty-state d-none">
                        <div class="empty-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <h3 class="empty-title">No images found</h3>
                        <p class="empty-description">Upload some images to get started</p>
                        <button class="btn-upload-empty" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="fas fa-upload me-2"></i>Upload Images
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadModalTitle">Bilder hochladen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm" enctype="multipart/form-data">
                        <!-- Upload Actions at Top -->
                        <div class="upload-actions-section mb-4">
                            <div class="current-folder-display mb-3">
                                <label class="form-label" id="currentLocationLabel">Aktuelle Position</label>
                                <div class="current-folder-indicator">
                                    <i class="fas fa-folder-open me-2"></i>
                                    <span id="currentFolderDisplay">Home</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <label for="folderSelect" class="form-label">Upload Destination</label>
                                    <select class="form-control" id="folderSelect">
                                        <option value="">Current Folder</option>
                                        <!-- Folders will be populated here -->
                                    </select>
                                    <input type="text" class="form-control mt-2 d-none" id="folderInput" placeholder="Or enter custom path">
                                    <button type="button" class="btn btn-link btn-sm p-0 mt-1" id="toggleCustomFolder">
                                        <i class="fas fa-edit"></i> Enter custom path
                                    </button>
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <div class="upload-buttons-group">
                                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInput').click()">
                                            <i class="fas fa-folder-open me-2"></i>Choose Files
                                        </button>
                                        <button type="button" class="btn btn-primary" id="uploadBtn" disabled>
                                            <i class="fas fa-upload me-2"></i>Upload <span id="uploadCount"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Modern Upload Area -->
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">Drag & Drop your images here</div>
                            <div class="upload-subtext">or use the "Choose Files" button above</div>
                            <input type="file" class="hidden-file-input" id="fileInput" multiple accept="image/*">
                            <div class="form-text mt-3">Supported formats: JPEG, PNG, GIF, WebP (max 10MB each)</div>
                        </div>

                        <!-- File Preview Section -->
                        <div class="file-preview-section d-none" id="filePreviewSection">
                            <div class="file-preview-title">
                                <i class="fas fa-images"></i>
                                Selected Files
                            </div>
                            <div class="file-preview-list" id="filePreviewList">
                                <!-- File previews will be added here -->
                            </div>
                        </div>

                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="d-none mt-4">
                            <div class="upload-progress-bar">
                                <div class="upload-progress-fill" id="progressFill"></div>
                            </div>
                            <div id="uploadStatus" class="text-muted small mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div class="modal fade" id="newFolderModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Folder</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="folderForm">
                        <div class="mb-3">
                            <label for="folderParentSelect" class="form-label">Parent Folder</label>
                            <select class="form-control" id="folderParentSelect">
                                <option value="">Home (Root)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="folderName" class="form-label">Folder Name</label>
                            <input type="text" class="form-control" id="folderName" placeholder="e.g. new-project" required>
                            <div class="form-text">Enter the name for the new folder</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Or enter full path manually:</label>
                            <input type="text" class="form-control" id="folderPath" placeholder="e.g. projects/new-project">
                            <div class="form-text">Use forward slashes to create nested folders</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createFolderBtn">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewTitle">Image Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="previewImage" class="img-fluid" src="" alt="Preview">
                    <div class="mt-3">
                        <input type="text" class="form-control" id="imageUrl" readonly>
                        <div class="d-flex justify-content-center gap-2 mt-2">
                            <button class="btn btn-sm btn-outline-secondary" id="previewPrevBtn">
                                <i class="fas fa-chevron-left me-1"></i> Previous
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="copyUrl()">
                                <i class="fas fa-copy me-1"></i> Copy URL
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="previewNextBtn">
                                Next <i class="fas fa-chevron-right ms-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./static/js/app.js" type="module"></script>
    <script src="./static/js/preview-modal.js" type="module"></script>
    <script src="./static/js/upload-manager.js" type="module"></script>
    <script src="./static/js/file-management.js" type="module"></script>
    <script src="./static/js/folder-tree-view.js" type="module"></script>

    <footer class="footer-version">
        v1.1
    </footer>
</body>
</html>
